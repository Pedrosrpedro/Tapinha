<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Tapa na Mão 3D - Realista</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #333; /* Fundo um pouco mais claro */
        }
        #ui-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            text-align: center;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        #message-box {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            height: 50px;
        }
        .hit { color: #ff4757 !important; }
        .fake { color: #ffa502 !important; }
        .success { color: #2ed573 !important; }
        
        button {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin-top: 10px;
            transition: background-color 0.2s, transform 0.1s;
        }
        #dodge-button {
            background-color: #007bff;
            color: white;
        }
        #dodge-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        #start-button {
            background-color: #28a745;
            color: white;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>
    
    <div id="ui-container">
        <div id="message-box">Clique para começar!</div>
        <button id="dodge-button" disabled>Desviar!</button>
        <button id="start-button">Começar Jogo</button>
    </div>

    <!-- Bibliotecas externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <script>
        // --- CONFIGURAÇÃO DA CENA 3D ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x2d3436);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        
        const canvasContainer = document.getElementById('canvas-container');
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true; // Habilitar sombras
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        canvasContainer.appendChild(renderer.domElement);

        // --- FUNÇÃO PARA CRIAR UMA MÃO ---
        function createHand(color) {
            const handGroup = new THREE.Group();
            
            const palmMaterial = new THREE.MeshStandardMaterial({ color: color, roughness: 0.7, metalness: 0.2 });
            
            // Palma da mão
            const palmGeometry = new THREE.BoxGeometry(2, 0.25, 2.5);
            const palm = new THREE.Mesh(palmGeometry, palmMaterial);
            palm.castShadow = true;
            palm.receiveShadow = true;
            handGroup.add(palm);

            // Dedos
            const fingerGeometry = new THREE.CapsuleGeometry(0.2, 1, 16, 32);
            for (let i = 0; i < 4; i++) {
                const finger = new THREE.Mesh(fingerGeometry, palmMaterial);
                finger.castShadow = true;
                finger.position.set(-0.75 + i * 0.5, 0, -1.7);
                finger.rotation.x = Math.PI / 2;
                handGroup.add(finger);
            }
            
            return handGroup;
        }

        const opponentHand = createHand(0xff8a80); // Cor avermelhada
        const playerHand = createHand(0x80a8ff);   // Cor azulada
        
        const initialPlayerPos = { x: 0, y: -0.2, z: 0 };
        const initialOpponentPos = { x: 0, y: 0.2, z: 0 };

        opponentHand.position.set(initialOpponentPos.x, initialOpponentPos.y, initialOpponentPos.z);
        opponentHand.rotation.x = Math.PI; // Vira a mão do oponente de cabeça para baixo
        playerHand.position.set(initialPlayerPos.x, initialPlayerPos.y, initialPlayerPos.z);
        
        scene.add(opponentHand);
        scene.add(playerHand);

        // --- CHÃO/PLANO DE FUNDO ---
        const planeGeometry = new THREE.PlaneGeometry(20, 20);
        const planeMaterial = new THREE.ShadowMaterial({ opacity: 0.3 }); // Material que só recebe sombras
        const plane = new THREE.Mesh(planeGeometry, planeMaterial);
        plane.rotation.x = -Math.PI / 2;
        plane.position.y = -1.5;
        plane.receiveShadow = true;
        scene.add(plane);

        // --- ILUMINAÇÃO APRIMORADA ---
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
        scene.add(hemiLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(5, 5, 5);
        dirLight.castShadow = true;
        dirLight.shadow.camera.top = 4;
        dirLight.shadow.camera.bottom = -4;
        dirLight.shadow.camera.left = -4;
        dirLight.shadow.camera.right = 4;
        dirLight.shadow.camera.near = 0.1;
        dirLight.shadow.camera.far = 40;
        scene.add(dirLight);

        // --- CÂMERA ---
        camera.position.set(0, 3, 6);
        camera.lookAt(0, 0, 0);

        // --- LÓGICA DO JOGO (IDÊNTICA À ANTERIOR) ---
        const startButton = document.getElementById('start-button');
        const dodgeButton = document.getElementById('dodge-button');
        const messageBox = document.getElementById('message-box');

        let gameActive = false, isOpponentAttacking = false, isOpponentFaking = false, freeSlapIncoming = false;
        let opponentActionTimeout;

        startButton.addEventListener('click', startGame);
        dodgeButton.addEventListener('click', playerDodge);

        function updateMessage(text, className = '') {
            messageBox.textContent = text;
            messageBox.className = className;
        }

        // --- ANIMAÇÕES 3D (ATUALIZADAS PARA AS MÃOS) ---
        function resetHandPositions() {
            gsap.to(playerHand.position, { ...initialPlayerPos, duration: 0.3 });
            gsap.to(opponentHand.position, { ...initialOpponentPos, duration: 0.3 });
        }

        function animateAttack() {
            gsap.to(opponentHand.position, { y: initialPlayerPos.y + 0.1, duration: 0.1, ease: 'power2.out' });
        }

        function animateFake() {
            const tl = gsap.timeline();
            tl.to(opponentHand.position, { y: 0, duration: 0.1, ease: 'power1.out' })
              .to(opponentHand.position, { y: initialOpponentPos.y, duration: 0.3, ease: 'bounce.out' });
        }
        
        function animateDodge() {
             gsap.to(playerHand.position, { x: -4, duration: 0.15, ease: 'power2.out' });
        }
        
        function animateCameraShake() {
            gsap.to(camera.position, { x: '+=0.1', yoyo: true, repeat: 3, duration: 0.05 });
        }

        // --- FUNÇÕES PRINCIPAIS DO JOGO ---
        function startGame() {
            gameActive = true;
            freeSlapIncoming = false;
            startButton.style.display = 'none';
            dodgeButton.disabled = false;
            resetHandPositions();
            prepareOpponentTurn();
        }

        function prepareOpponentTurn() {
            if (!gameActive) return;
            
            updateMessage("Prepare-se...");
            dodgeButton.disabled = false;
            isOpponentAttacking = false;
            isOpponentFaking = false;
            resetHandPositions();

            if (freeSlapIncoming) {
                updateMessage("TAPA DE GRAÇA!", 'hit');
                dodgeButton.disabled = true;
                opponentActionTimeout = setTimeout(() => {
                    animateAttack();
                    animateCameraShake();
                    updateMessage("Você levou um tapa!", 'hit');
                    freeSlapIncoming = false;
                    setTimeout(prepareOpponentTurn, 2000);
                }, 1500);
                return;
            }

            const delay = Math.random() * 2500 + 1200;

            opponentActionTimeout = setTimeout(() => {
                if (Math.random() > 0.5) { performAttack(); } 
                else { performFake(); }
            }, delay);
        }

        function performAttack() {
            isOpponentAttacking = true;
            updateMessage("AGORA!", 'success');
            animateAttack();
            
            opponentActionTimeout = setTimeout(() => {
                if (isOpponentAttacking) {
                    gameActive = false;
                    isOpponentAttacking = false;
                    animateCameraShake();
                    updateMessage("Você levou um tapa!", 'hit');
                    dodgeButton.disabled = true;
                    startButton.textContent = "Jogar Novamente";
                    startButton.style.display = 'block';
                }
            }, 400); // Tempo de reação
        }

        function performFake() {
            isOpponentFaking = true;
            updateMessage("...", 'fake');
            animateFake();
            
            setTimeout(() => {
                if (gameActive && isOpponentFaking) {
                    isOpponentFaking = false;
                    updateMessage("Ufa, foi só uma finta.");
                    setTimeout(prepareOpponentTurn, 2000);
                }
            }, 1500);
        }

        function playerDodge() {
            if (!gameActive) return;
            clearTimeout(opponentActionTimeout);

            if (isOpponentAttacking) {
                isOpponentAttacking = false;
                gameActive = false;
                updateMessage("Você desviou!", 'success');
                animateDodge();
                dodgeButton.disabled = true;
                startButton.textContent = "Jogar Novamente";
                startButton.style.display = 'block';
            } else {
                isOpponentFaking = false;
                gameActive = true; 
                freeSlapIncoming = true;
                updateMessage("Caiu na finta!", 'hit');
                dodgeButton.disabled = true;
                setTimeout(prepareOpponentTurn, 2000);
            }
        }

        // --- LOOP DE RENDERIZAÇÃO E RESIZE ---
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
