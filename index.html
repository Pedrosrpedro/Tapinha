<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Tapa na Mão 3D</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            overflow: hidden; /* Previne barras de rolagem */
            background-color: #111;
        }
        #ui-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 450px;
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        #message-box {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            height: 50px;
        }
        .hit { color: #ff4757 !important; }
        .fake { color: #ffa502 !important; }
        .success { color: #2ed573 !important; }
        
        button {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin-top: 10px;
            transition: background-color 0.2s, transform 0.1s;
        }
        #dodge-button {
            background-color: #007bff;
            color: white;
        }
        #dodge-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        #start-button {
            background-color: #28a745;
            color: white;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>
    
    <div id="ui-container">
        <div id="message-box">Clique para começar!</div>
        <button id="dodge-button" disabled>Desviar!</button>
        <button id="start-button">Começar Jogo</button>
    </div>

    <!-- Bibliotecas externas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

    <script>
        // --- CONFIGURAÇÃO DA CENA 3D ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        
        const canvasContainer = document.getElementById('canvas-container');
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        canvasContainer.appendChild(renderer.domElement);

        // --- OBJETOS 3D (BRAÇOS) ---
        const armGeometry = new THREE.BoxGeometry(4, 0.5, 2); // Largura, Altura, Profundidade
        const opponentMaterial = new THREE.MeshStandardMaterial({ color: 0xff9c99, metalness: 0.3, roughness: 0.5 });
        const playerMaterial = new THREE.MeshStandardMaterial({ color: 0x007bff, metalness: 0.3, roughness: 0.5 });

        const opponentArm = new THREE.Mesh(armGeometry, opponentMaterial);
        const playerArm = new THREE.Mesh(armGeometry, playerMaterial);
        
        const initialPlayerPos = { x: 0, y: -0.5, z: 0 };
        const initialOpponentPos = { x: 0, y: 0.5, z: 0 };

        opponentArm.position.set(initialOpponentPos.x, initialOpponentPos.y, initialOpponentPos.z);
        playerArm.position.set(initialPlayerPos.x, initialPlayerPos.y, initialPlayerPos.z);
        
        scene.add(opponentArm);
        scene.add(playerArm);

        // --- ILUMINAÇÃO ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // --- CÂMERA ---
        camera.position.z = 5;
        camera.position.y = 2;
        camera.lookAt(0, 0, 0);

        // --- LÓGICA DO JOGO ---
        const startButton = document.getElementById('start-button');
        const dodgeButton = document.getElementById('dodge-button');
        const messageBox = document.getElementById('message-box');

        let gameActive = false;
        let isOpponentAttacking = false;
        let isOpponentFaking = false;
        let freeSlapIncoming = false;
        let opponentActionTimeout;

        startButton.addEventListener('click', startGame);
        dodgeButton.addEventListener('click', playerDodge);

        function updateMessage(text, className = '') {
            messageBox.textContent = text;
            messageBox.className = className;
        }

        // --- ANIMAÇÕES 3D com GSAP ---
        function resetArmPositions() {
            gsap.to(playerArm.position, { ...initialPlayerPos, duration: 0.3 });
            gsap.to(opponentArm.position, { ...initialOpponentPos, duration: 0.3 });
        }

        function animateAttack() {
            gsap.to(opponentArm.position, { y: initialPlayerPos.y, duration: 0.12, ease: 'power2.out' });
        }

        function animateFake() {
            const tl = gsap.timeline();
            tl.to(opponentArm.position, { y: 0, duration: 0.1, ease: 'power1.out' })
              .to(opponentArm.position, { y: initialOpponentPos.y, duration: 0.2, ease: 'bounce.out' });
        }
        
        function animateDodge() {
             gsap.to(playerArm.position, { x: -6, duration: 0.2, ease: 'power2.out' });
        }

        // --- FUNÇÕES PRINCIPAIS DO JOGO ---
        function startGame() {
            gameActive = true;
            freeSlapIncoming = false;
            startButton.style.display = 'none';
            dodgeButton.disabled = false;
            resetArmPositions();
            prepareOpponentTurn();
        }

        function prepareOpponentTurn() {
            if (!gameActive) return;
            
            updateMessage("Prepare-se...");
            dodgeButton.disabled = false;
            isOpponentAttacking = false;
            isOpponentFaking = false;
            resetArmPositions();

            if (freeSlapIncoming) {
                updateMessage("TAPA DE GRAÇA!", 'hit');
                dodgeButton.disabled = true;
                opponentActionTimeout = setTimeout(() => {
                    animateAttack();
                    updateMessage("Você levou um tapa!", 'hit');
                    freeSlapIncoming = false;
                    setTimeout(prepareOpponentTurn, 2000);
                }, 1500);
                return;
            }

            const delay = Math.random() * 2500 + 1000;

            opponentActionTimeout = setTimeout(() => {
                if (Math.random() > 0.5) {
                    performAttack();
                } else {
                    performFake();
                }
            }, delay);
        }

        function performAttack() {
            isOpponentAttacking = true;
            updateMessage("AGORA!", 'success');
            animateAttack();
            
            opponentActionTimeout = setTimeout(() => {
                if (isOpponentAttacking) {
                    gameActive = false;
                    isOpponentAttacking = false;
                    updateMessage("Você levou um tapa!", 'hit');
                    dodgeButton.disabled = true;
                    startButton.textContent = "Jogar Novamente";
                    startButton.style.display = 'block';
                }
            }, 350); // Tempo de reação
        }

        function performFake() {
            isOpponentFaking = true;
            updateMessage("...", 'fake');
            animateFake();
            
            setTimeout(() => {
                if (gameActive && isOpponentFaking) {
                    isOpponentFaking = false;
                    updateMessage("Ufa, foi só uma finta.");
                    setTimeout(prepareOpponentTurn, 2000);
                }
            }, 1500);
        }

        function playerDodge() {
            if (!gameActive) return;
            clearTimeout(opponentActionTimeout);

            if (isOpponentAttacking) {
                isOpponentAttacking = false;
                gameActive = false;
                updateMessage("Você desviou!", 'success');
                animateDodge();
                dodgeButton.disabled = true;
                startButton.textContent = "Jogar Novamente";
                startButton.style.display = 'block';
            } else {
                isOpponentFaking = false;
                gameActive = true; 
                freeSlapIncoming = true;
                updateMessage("Caiu na finta!", 'hit');
                dodgeButton.disabled = true;
                setTimeout(prepareOpponentTurn, 2000);
            }
        }

        // --- LOOP DE RENDERIZAÇÃO E RESIZE ---
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
